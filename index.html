<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è - Ultra Modern</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --p: #d35400; --s: #f39c12; --bg: #fdfaf6; --c: #ffffff;
            --t: #2d3436; --sh: 0 10px 40px rgba(0,0,0,0.05); --glass: rgba(255, 255, 255, 0.7);
        }
        .dark-mode { --bg: #0f0f0f; --t: #f0f0f0; --c: #1a1a1a; --sh: 0 10px 40px rgba(0,0,0,0.4); --glass: rgba(30, 30, 30, 0.8); }
        
        * { user-select: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Noto Sans Sinhala', 'Poppins', sans-serif; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body { background: var(--bg); color: var(--t); margin: 0; padding-bottom: 120px; overflow-x: hidden; }

        /* --- Glassmorphism Header --- */
        .header { 
            background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 25px 20px; text-align: center; position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); box-shadow: var(--sh);
            border-bottom-left-radius: 35px; border-bottom-right-radius: 35px;
        }
        .app-name { font-size: 32px; font-weight: 700; background: linear-gradient(to right, var(--p), #c0392b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        .slogan { font-size: 13px; font-style: italic; opacity: 0.7; margin-top: 5px; color: var(--t); }

        /* --- Stats Chart Element --- */
        .stats-box { background: var(--c); padding: 15px; border-radius: 20px; display: flex; align-items: flex-end; gap: 8px; height: 100px; margin-top: 15px; justify-content: center; box-shadow: inset 0 2px 10px rgba(0,0,0,0.02); }
        .bar { width: 15px; background: var(--p); border-radius: 5px; animation: grow 1s ease-out; }
        @keyframes grow { from { height: 0; } }

        /* --- Floating Navigation --- */
        .bottom-nav { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 550px; 
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; padding: 12px 5px; 
            border-radius: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.15); z-index: 1001;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-item { font-size: 10px; cursor: pointer; opacity: 0.4; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { opacity: 1; color: var(--p); transform: translateY(-8px) scale(1.1); font-weight: 700; }
        .nav-icon { font-size: 24px; margin-bottom: 4px; }

        .container { padding: 15px 20px; max-width: 750px; margin: auto; }
        
        /* --- Premium Article Cards --- */
        .article-card { 
            background: var(--c); padding: 25px; border-radius: 30px; margin-bottom: 25px; 
            box-shadow: var(--sh); position: relative; border: 1px solid rgba(0,0,0,0.02);
        }
        .title { font-size: 22px; font-weight: 700; color: var(--p); line-height: 1.4; }
        .snippet { font-size: 16px; opacity: 0.8; margin-top: 10px; line-height: 1.6; }
        .read-tag { position: absolute; top: 15px; right: 25px; background: #e8f5e9; color: #27ae60; padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 700; }

        /* --- Buttons --- */
        .btn { 
            border: none; padding: 12px 25px; border-radius: 50px; cursor: pointer; font-weight: 700; font-size: 14px;
            background: linear-gradient(135deg, var(--p), var(--s)); color: white; box-shadow: 0 10px 20px rgba(211, 84, 0, 0.2); margin: 5px;
        }
        .btn-ghost { background: transparent; color: var(--p); border: 2px solid var(--p); box-shadow: none; }

        /* --- Timer Circle --- */
        .timer-ui { 
            width: 200px; height: 200px; border-radius: 50%; border: 10px solid rgba(211, 84, 0, 0.05);
            margin: 20px auto; display: flex; align-items: center; justify-content: center;
            font-size: 50px; font-weight: 700; color: var(--p); border-top-color: var(--p); position: relative;
        }

        .hidden { display: none; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="header" id="app-header">
    <h1 class="app-name">‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è</h1>
    <div class="slogan">"‡∂¥‡∑ä‚Äç‡∂ª‡∂•‡∑è‡∑Ä‡∑ö ‡∂Ü‡∂Ω‡∑ù‡∂ö‡∂∫ ‡∂¥‡∂≠‡∑î‡∂ª‡∑î‡∑Ä‡∂± ‡∑É‡∂Ø‡∑Ñ‡∂∏‡∑ä ‡∂Ö‡∑Ä‡∂ö‡∑è‡∑Å‡∂∫"</div>
    
    <div class="stats-box">
        <div class="bar" style="height: 40%;"></div>
        <div class="bar" style="height: 60%;"></div>
        <div class="bar" style="height: 30%;"></div>
        <div class="bar" style="height: 80%;"></div>
        <div class="bar" style="height: 50%;"></div>
        <div class="bar" style="height: 90%;"></div>
        <div class="bar" style="height: 20%;"></div>
        <div style="font-size: 10px; opacity: 0.5; position: absolute; bottom: 5px;">‡∑É‡∂≠‡∑í‡∂¥‡∂≠‡∑è ‡∂∞‡∂ª‡∑ä‡∂∏ ‡∑Å‡∑ä‚Äç‡∂ª‡∑Ä‡∂´‡∂∫</div>
    </div>
    
    <div style="margin-top: 15px; font-size: 14px; font-weight: 600; color: var(--p);">
        <span id="clock">00:00:00</span> | <span id="date">‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∑Ä‡∑ö...</span>
    </div>
    <button class="btn btn-ghost" style="padding: 5px 15px; font-size: 10px; margin-top: 10px;" onclick="toggleDarkMode()">üåô Dark Mode</button>
</div>

<div class="container" id="main-content">
    <div id="page-home">
        <div class="article-card" style="text-align:center;">
            <h3 style="margin:0; opacity: 0.6;">üßò ‡∂∑‡∑è‡∑Ä‡∂±‡∑è ‡∂ö‡∑è‡∂Ω ‡∂ú‡∂´‡∂ö‡∂∫</h3>
            <div class="timer-ui" id="timer-display">10:00</div>
            <button class="btn" onclick="startTimer()">‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑‡∂∫</button>
            <button class="btn btn-ghost" onclick="resetTimer()">‡∂±‡∑ê‡∑Ä‡∂≠</button>
        </div>
        <div id="article-list"></div>
    </div>

    <div id="page-reader" class="hidden">
        <button class="btn btn-ghost" onclick="showPage('page-home')">‚¨ÖÔ∏è ‡∂Ü‡∂¥‡∑É‡∑î</button>
        <div class="article-card">
            <h2 id="view-title" class="title" style="font-size: 26px;"></h2>
            <div id="view-content" style="line-height:1.9; text-align:justify; font-size:18px;"></div>
            
            <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px; text-align:center;">
                <p style="font-size: 12px; opacity: 0.5;">‡∂∏‡∑ô‡∂∏ ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∑Ä‡∑í‡∂∏‡∑É‡∂±‡∑ä‡∂±:</p>
                <button class="btn" style="background:#25D366" onclick="contactWA()">üí¨ WhatsApp</button>
                <button class="btn" style="background:#8e44ad" onclick="readArt()">üîä ‡∑Å‡∑ä‚Äç‡∂ª‡∑Ä‡∂´‡∂∫</button>
                <div style="margin-top: 15px;">
                    <button class="btn btn-ghost" onclick="changeSize(2)">A+</button>
                    <button class="btn btn-ghost" onclick="changeSize(-2)">A-</button>
                </div>
            </div>
        </div>
    </div>

    <div id="page-merit" class="hidden">
        <div class="article-card">
            <h2 class="title">üìñ ‡∂¥‡∑í‡∂Ç ‡∂¥‡∑ú‡∂≠</h2>
            <input type="date" id="merit-date" style="width:100%; padding:15px; border-radius:15px; border:1px solid #ddd;">
            <textarea id="merit-text" rows="3" placeholder="‡∂Ö‡∂Ø ‡∂ö‡∑Ö ‡∂¥‡∑í‡∂±‡∑ä‡∂ö‡∂∏..." style="width:100%; padding:15px; border-radius:15px; border:1px solid #ddd; margin: 15px 0;"></textarea>
            <button class="btn" style="width:100%" onclick="addMerit()">‡∑É‡∂ß‡∑Ñ‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
        </div>
        <div id="merit-list"></div>
    </div>

    <div id="page-donate" class="hidden">
        <div class="article-card">
            <h2 class="title" style="text-align:center;">üôè ‡∂Ü‡∂∞‡∑è‡∂ª (Support Us)</h2>
            <div style="background:rgba(211, 84, 0, 0.05); padding:20px; border-radius:20px; border:1px dashed var(--p);">
                <b>Bank:</b> BOC (‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä)<br><b>Account:</b> 1234567890<br><b>Name:</b> Dharma Nethra
            </div>
            <button class="btn" style="width:100%; margin-top:20px; background:#25D366" onclick="window.open('https://wa.me/94771234567?text=Donation')">üí¨ ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠ ‡∂ë‡∑Ä‡∂±‡∑ä‡∂±</button>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="showPage('page-home', this)"><span class="nav-icon">üè†</span>‡∂∏‡∑î‡∂Ω‡∑ä ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä</div>
    <div class="nav-item" onclick="showPage('page-fav', this)"><span class="nav-icon">‚ù§Ô∏è</span>‡∂¥‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∂≠‡∂∏</div>
    <div class="nav-item" onclick="showPage('page-merit', this)"><span class="nav-icon">üìñ</span>‡∂¥‡∑í‡∂Ç ‡∂¥‡∑ú‡∂≠</div>
    <div class="nav-item" onclick="showPage('page-donate', this)"><span class="nav-icon">üôè</span>‡∂Ü‡∂∞‡∑è‡∂ª</div>
    <div class="nav-item" onclick="showPage('page-contact', this)"><span class="nav-icon">üìû</span>‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞</div>
</div>

<audio id="bell" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDEiwhtAIdoqdMIV5n_bdDoKuIrCkjqr3M",
        authDomain: "dharma-nethra.firebaseapp.com",
        projectId: "dharma-nethra",
        storageBucket: "dharma-nethra.firebasestorage.app",
        messagingSenderId: "365410669829",
        appId: "1:365410669829:web:d9a9465ed1f1f2b792936c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let articles = []; let curIdx = 0;
    let favs = JSON.parse(localStorage.getItem('f')) || [];
    let reads = JSON.parse(localStorage.getItem('r')) || [];
    let merits = JSON.parse(localStorage.getItem('m')) || [];
    let fs = 18;

    function tick() {
        const n = new Date();
        document.getElementById('clock').innerText = n.toLocaleTimeString('si-LK');
        document.getElementById('date').innerText = n.toLocaleDateString('si-LK', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
    } setInterval(tick, 1000);

    async function load() {
        const s = await db.collection("articles").get();
        articles = s.docs.map(doc => doc.data());
        render(articles);
    }

    function render(data) {
        const list = document.getElementById('article-list');
        list.innerHTML = data.map((a, i) => `
            <div class="article-card" onclick="openArt(${i})">
                ${reads.includes(a.id) ? '<span class="read-tag">‡∂ö‡∑í‡∂∫‡∑Ä‡∂± ‡∂Ω‡∂Ø‡∑ì</span>' : ''}
                <div class="title">${a.title}</div>
                <p class="snippet">${a.snippet}</p>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px;">
                    <span style="font-size:12px; color:var(--p); font-weight:700;">‡∂ö‡∑í‡∂∫‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂≠‡∂ß‡∑ä‡∂ß‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</span>
                    <span style="font-size:24px;" onclick="event.stopPropagation(); toggleFav('${a.id}')">${favs.includes(a.id) ? 'üíñ' : '‚ù§Ô∏è'}</span>
                </div>
            </div>
        `).join('');
    }

    function openArt(i) {
        curIdx = i; const a = articles[i];
        if(!reads.includes(a.id)) { reads.push(a.id); localStorage.setItem('r', JSON.stringify(reads)); }
        showPage('page-reader');
        document.getElementById('view-title').innerText = a.title;
        document.getElementById('view-content').innerText = a.content;
    }

    function showPage(id, el) {
        const ps = ['page-home', 'page-reader', 'page-merit', 'page-donate'];
        ps.forEach(p => document.getElementById(p).classList.add('hidden'));
        
        const h = document.getElementById('app-header');
        if (id === 'page-home') h.classList.remove('hidden'); else h.classList.add('hidden');

        if(el) { document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); el.classList.add('active'); }
        
        if(id === 'page-fav') {
            document.getElementById('page-home').classList.remove('hidden');
            render(articles.filter(x => favs.includes(x.id)));
            h.classList.remove('hidden');
        } else {
            document.getElementById(id).classList.remove('hidden');
            if(id === 'page-home') render(articles);
            if(id === 'page-merit') drawMerits();
        }
        window.scrollTo(0,0);
    }

    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    function changeSize(v) { fs += v; document.getElementById('view-content').style.fontSize = fs + 'px'; }
    function readArt() { window.speechSynthesis.cancel(); let u = new SpeechSynthesisUtterance(document.getElementById('view-content').innerText); u.lang='si-LK'; window.speechSynthesis.speak(u); }
    function contactWA() { window.open(`https://wa.me/94771234567?text=${encodeURIComponent(`‡∂ú‡∑û‡∂ª‡∑Ä‡∂±‡∑ì‡∂∫ ‡∑É‡∑ä‡∑Ä‡∑è‡∂∏‡∑í‡∂±‡∑ä ‡∑Ä‡∑Ñ‡∂±‡∑ä‡∑É, '${articles[curIdx].title}' ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä‡∂∫‡∑í:\n\n`)}`); }
    function toggleFav(id) { favs = favs.includes(id) ? favs.filter(x => x !== id) : [...favs, id]; localStorage.setItem('f', JSON.stringify(favs)); render(articles); }

    function addMerit() {
        const d = document.getElementById('merit-date').value; const t = document.getElementById('merit-text').value;
        if(d && t) { merits.unshift({ d, t, id: Date.now() }); localStorage.setItem('m', JSON.stringify(merits)); drawMerits(); document.getElementById('merit-text').value = ""; }
    }
    function drawMerits() {
        document.getElementById('merit-list').innerHTML = merits.map(m => `
            <div class="article-card">
                <div style="font-weight:700; color:var(--p);">${m.d}</div>
                <p style="margin:5px 0;">${m.t}</p>
                <span style="position:absolute; right:20px; top:20px; cursor:pointer;" onclick="delMerit(${m.id})">üóëÔ∏è</span>
            </div>
        `).join('');
    }
    function delMerit(id) { merits = merits.filter(x => x.id !== id); localStorage.setItem('m', JSON.stringify(merits)); drawMerits(); }

    let t_int;
    function startTimer() {
        let s = 600; clearInterval(t_int);
        t_int = setInterval(() => { s--; let m=Math.floor(s/60), sec=s%60; document.getElementById('timer-display').innerText = `${m}:${sec < 10 ? '0'+sec : sec}`; if(s <= 0) { clearInterval(t_int); document.getElementById('bell').play(); alert("‡∂∑‡∑è‡∑Ä‡∂±‡∑è ‡∂ö‡∑è‡∂Ω‡∂∫ ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä!"); } }, 1000);
    }
    function resetTimer() { clearInterval(t_int); document.getElementById('timer-display').innerText = "10:00"; }

    window.onload = () => { tick(); load(); document.getElementById('merit-date').valueAsDate = new Date(); };
</script>
</body>
</html>