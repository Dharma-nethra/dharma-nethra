<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è - Dharma Nethra</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #f8f9fa; --text: #2d3436; --card: #ffffff; --primary: #d35400; --accent: #8e44ad; --read: #27ae60; }
        .dark-mode { --bg: #1a1a1a; --text: #f0f0f0; --card: #2d2d2d; --primary: #e67e22; }
        * { user-select: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Arial, sans-serif; transition: 0.3s; margin: 0; padding-bottom: 130px; }
        .header { background: var(--card); padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .clock { font-size: 24px; font-weight: bold; color: var(--accent); }
        .date { font-size: 14px; opacity: 0.8; margin-bottom: 12px; }
        .slogan { font-size: 13px; font-style: italic; color: var(--text); margin-top: 5px; }
        .btn { border: none; padding: 10px 18px; border-radius: 25px; cursor: pointer; background: var(--primary); color: white; margin: 5px; font-weight: bold; }
        .container { padding: 15px; max-width: 650px; margin: auto; }
        .article-card { background: var(--card); padding: 20px; border-radius: 18px; margin-bottom: 20px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); position: relative; }
        .title { font-size: 20px; font-weight: bold; color: var(--primary); margin-bottom: 10px; }
        .content-text { font-size: 18px; line-height: 1.7; text-align: justify; }
        .read-status { color: var(--read); font-size: 12px; font-weight: bold; margin-bottom: 5px; display: block; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; flex-wrap: wrap; justify-content: space-around; padding: 12px 0; border-top: 4px solid var(--primary); z-index: 1000; box-shadow: 0 -3px 15px rgba(0,0,0,0.1); }
        .nav-item { text-align: center; font-size: 11px; cursor: pointer; min-width: 60px; }
        .hidden { display: none; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; }
        .merit-item { background: #fff3e0; padding: 15px; border-radius: 12px; margin-bottom: 10px; color: #333; position: relative; border-left: 5px solid #ff9800; }
        #timer-display { font-size: 55px; text-align: center; margin: 25px; font-family: monospace; color: var(--primary); font-weight: bold; }
        .contact-link { display: flex; align-items: center; padding: 15px; background: #eee; border-radius: 10px; margin-bottom: 10px; text-decoration: none; color: inherit; font-weight: bold; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="header">
    <div style="font-size: 28px; font-weight: bold; color: var(--primary);">‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è</div>
    <div class="slogan">"‡∂¥‡∑ä‚Äç‡∂ª‡∂•‡∑è‡∑Ä‡∑ö ‡∂Ü‡∂Ω‡∑ù‡∂ö‡∂∫ ‡∂¥‡∂≠‡∑î‡∂ª‡∑î‡∑Ä‡∂± ‡∑É‡∂Ø‡∑Ñ‡∂∏‡∑ä ‡∂Ö‡∑Ä‡∂ö‡∑è‡∑Å‡∂∫"</div>
    <div class="clock" id="clock">00:00:00</div>
    <div id="date" class="date">‡∂Ø‡∑í‡∂±‡∂∫ ‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∑Ä‡∑ö...</div>
    <button class="btn" onclick="toggleDarkMode()">üåô Dark Mode</button>
</div>

<div class="container" id="main-content">
    
    <div id="page-home">
        <div class="article-card">
            <h3 style="text-align:center;">üßò ‡∂∑‡∑è‡∑Ä‡∂±‡∑è ‡∂ö‡∑è‡∂Ω ‡∂ú‡∂´‡∂ö‡∂∫</h3>
            <div id="timer-display">10:00</div>
            <div style="text-align:center;">
                <button class="btn" onclick="startTimer()">‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑‡∂∫</button>
                <button class="btn" style="background:#7f8c8d" onclick="resetTimer()">‡∂±‡∑ê‡∑Ä‡∂≠ ‡∑É‡∂ö‡∑É‡∂±‡∑ä‡∂±</button>
            </div>
        </div>
        <div id="article-list">‡∑É‡∂Ø‡∑ä‡∂∞‡∂ª‡∑ä‡∂∏‡∂∫ ‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...</div>
    </div>

    <div id="page-detail" class="hidden">
        <button class="btn" style="background:#34495e" onclick="showPage('page-home')">‚¨ÖÔ∏è ‡∂Ü‡∂¥‡∑É‡∑î</button>
        <div class="article-card">
            <h2 id="view-title" class="title"></h2>
            <hr>
            <div id="view-content" class="content-text"></div>
            <div style="margin-top:25px; display:flex; flex-wrap:wrap; justify-content:center; gap:10px; border-top:1px solid #eee; padding-top:15px;">
                <button class="btn" onclick="changeFontSize(2)">A+</button>
                <button class="btn" onclick="changeFontSize(-2)">A-</button>
                <button class="btn" style="background:#8e44ad" onclick="readArt()">üîä ‡∑Å‡∑ä‚Äç‡∂ª‡∑Ä‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
                <button class="btn" style="background:#25D366" onclick="contactWhatsApp()">üí¨ WhatsApp ‡∑Ä‡∑í‡∂∏‡∑É‡∑ì‡∂∏‡∑ä</button>
                <button class="btn" style="background:#e74c3c" onclick="contactEmail()">üìß Email ‡∑Ä‡∑í‡∂∏‡∑É‡∑ì‡∂∏‡∑ä</button>
            </div>
            <div style="display:flex; justify-content: space-between; margin-top:20px;">
                <button class="btn" onclick="navArt(-1)">‚¨ÖÔ∏è ‡∂¥‡∑ô‡∂ª ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫</button>
                <button class="btn" onclick="navArt(1)">‡∂∏‡∑ì‡∑Ö‡∂ü ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="page-merit" class="hidden">
        <div class="article-card">
            <h2 class="title">üìñ ‡∂¥‡∑í‡∂Ç ‡∂¥‡∑ú‡∂≠</h2>
            <input type="date" id="merit-date">
            <textarea id="merit-text" rows="3" placeholder="‡∂î‡∂∂ ‡∂ö‡∑Ö ‡∂ã‡∂≠‡∑î‡∂∏‡∑ä ‡∂¥‡∑í‡∂±‡∑ä‡∂ö‡∂∏ ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∑É‡∂ß‡∑Ñ‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±..."></textarea>
            <button class="btn" style="width:100%" onclick="addMerit()">‡∂¥‡∑í‡∂Ç ‡∂¥‡∑ú‡∂≠‡∑ö ‡∑É‡∂ß‡∑Ñ‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
            <div id="merit-list" style="margin-top:20px;"></div>
        </div>
    </div>

    <div id="page-donate" class="hidden">
        <div class="article-card">
            <h2 class="title">üôè ‡∂Ü‡∂∞‡∑è‡∂ª (Support Us)</h2>
            <p>‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂¥‡∑ä‚Äç‡∂ª‡∂†‡∑è‡∂ª‡∂ö ‡∂ö‡∂ß‡∂∫‡∑î‡∂≠‡∑î ‡∂¥‡∑Ä‡∂≠‡∑ä‡∑Ä‡∑è‡∂ú‡∑ô‡∂± ‡∂∫‡∑è‡∂∏‡∂ß ‡∂î‡∂∂‡∂ú‡∑ö ‡∑É‡∑Ñ‡∂∫‡∑ù‡∂ú‡∂∫ ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö.</p>
            <div style="background:#fff3e0; padding:20px; border-radius:15px; border:1px dashed #d35400;">
                <p><b>‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä:</b> ‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä<br><b>‡∂±‡∑è‡∂∏‡∂∫:</b> ‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω<br><b>‡∂Ö‡∂Ç‡∂ö‡∂∫:</b> 1234567890<br><b>‡∑Å‡∑è‡∂õ‡∑è‡∑Ä:</b> ‡∂ö‡∑ú‡∑Ö‡∂π</p>
            </div>
            <button class="btn" style="background:#25D366; width:100%; margin-top:15px;" onclick="window.open('https://wa.me/94771234567?text=Donation Receipt')">üí¨ WhatsApp ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠ ‡∂ë‡∑Ä‡∂±‡∑ä‡∂±</button>
        </div>
    </div>

    <div id="page-about" class="hidden">
        <div class="article-card">
            <h2 class="title">üßò ‡∑É‡∑ä‡∑Ä‡∑è‡∂∏‡∑ì‡∂±‡∑ä ‡∑Ä‡∑Ñ‡∂±‡∑ä‡∑É‡∑ö ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä</h2>
            <p>‡∂¥‡∑ñ‡∂¢‡∑ä‚Äç‡∂∫ [‡∑É‡∑ä‡∑Ä‡∑è‡∂∏‡∑ì‡∂±‡∑ä ‡∑Ä‡∑Ñ‡∂±‡∑ä‡∑É‡∑ö‡∂ú‡∑ö ‡∂±‡∂∏] ‡∑Ä‡∑Ñ‡∂±‡∑ä‡∑É‡∑ö ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫...</p>
            <h2 class="title">üèõÔ∏è ‡∂Ü‡∂∫‡∂≠‡∂±‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä</h2>
            <p>‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è ‡∂Ü‡∂∫‡∂≠‡∂±‡∂∫‡∑ö ‡∂Ø‡∑ê‡∂ö‡∑ä‡∂∏ ‡∑É‡∑Ñ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂´‡∑î...</p>
        </div>
    </div>

    <div id="page-contact" class="hidden">
        <div class="article-card">
            <h2 class="title">üìû ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∑Ä‡∂±‡∑ä‡∂±</h2>
            <a href="tel:+94771234567" class="contact-link">üìû ‡∂Ö‡∂∏‡∂≠‡∂±‡∑ä‡∂±: +94 77 123 4567</a>
            <a href="mailto:info@dharmanethra.lk" class="contact-link" style="background:#fff3e3;">üìß ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑î‡∂≠‡∑ä ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫: info@dharmanethra.lk</a>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item" onclick="showPage('page-home')">üè†<br>‡∂∏‡∑î‡∂Ω‡∑ä ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä</div>
    <div class="nav-item" onclick="showPage('page-fav')">‚ù§Ô∏è<br>‡∂¥‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∂≠‡∂∏</div>
    <div class="nav-item" onclick="showPage('page-merit')">üìñ<br>‡∂¥‡∑í‡∂Ç ‡∂¥‡∑ú‡∂≠</div>
    <div class="nav-item" onclick="showPage('page-donate')">üôè<br>‡∂Ü‡∂∞‡∑è‡∂ª</div>
    <div class="nav-item" onclick="showPage('page-about')">‚ÑπÔ∏è<br>‡∂Ö‡∂¥ ‡∂ú‡∑ê‡∂±</div>
    <div class="nav-item" onclick="showPage('page-contact')">üìû<br>‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∑Ä‡∂±‡∑ä‡∂±</div>
</div>

<audio id="bell" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDEiwhtAIdoqdMIV5n_bdDoKuIrCkjqr3M",
        authDomain: "dharma-nethra.firebaseapp.com",
        projectId: "dharma-nethra",
        storageBucket: "dharma-nethra.firebasestorage.app",
        messagingSenderId: "365410669829",
        appId: "1:365410669829:web:d9a9465ed1f1f2b792936c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let articles = [];
    let curIdx = 0;
    let favs = JSON.parse(localStorage.getItem('f')) || [];
    let reads = JSON.parse(localStorage.getItem('r')) || [];
    let merits = JSON.parse(localStorage.getItem('m')) || [];
    let fSize = 18;

    function tick() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('si-LK');
        document.getElementById('date').innerText = now.toLocaleDateString('si-LK', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }
    setInterval(tick, 1000);

    async function getArts() {
        const snap = await db.collection("articles").get();
        articles = snap.docs.map(doc => doc.data());
        draw(articles);
    }

    function draw(data) {
        const list = document.getElementById('article-list');
        list.innerHTML = data.map((a, i) => `
            <div class="article-card" onclick="openArt(${i})">
                ${reads.includes(a.id) ? '<span class="read-status">‚úÖ ‡∂ö‡∑í‡∂∫‡∑Ä‡∂± ‡∂Ω‡∂Ø‡∑ì</span>' : ''}
                <div class="title">${a.title}</div>
                <div class="snippet">${a.snippet}</div>
                <div style="margin-top:10px; font-size:22px;" onclick="event.stopPropagation(); toggleFav('${a.id}')">
                    ${favs.includes(a.id) ? 'üíñ' : '‚ù§Ô∏è'}
                </div>
            </div>
        `).join('');
    }

    function openArt(i) {
        curIdx = i;
        const a = articles[i];
        if(!reads.includes(a.id)) { reads.push(a.id); localStorage.setItem('r', JSON.stringify(reads)); }
        showPage('page-detail');
        document.getElementById('view-title').innerText = a.title;
        document.getElementById('view-content').innerText = a.content;
    }

    // ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫ ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫ (WhatsApp/Email)
    function contactWhatsApp() {
        const title = articles[curIdx].title;
        const msg = `‡∂ú‡∑û‡∂ª‡∑Ä‡∂±‡∑ì‡∂∫ ‡∑É‡∑ä‡∑Ä‡∑è‡∂∏‡∑í‡∂±‡∑ä ‡∑Ä‡∑Ñ‡∂±‡∑ä‡∑É, '${title}' ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä‡∂∫‡∑í: \n\n`;
        window.open(`https://wa.me/94771234567?text=${encodeURIComponent(msg)}`);
    }

    function contactEmail() {
        const title = articles[curIdx].title;
        const subject = encodeURIComponent(`‡∂∞‡∂ª‡∑ä‡∂∏ ‡∂±‡∑ö‡∂≠‡∑ä‚Äç‡∂ª‡∑è - ${title}`);
        const body = encodeURIComponent(`‡∂ú‡∑û‡∂ª‡∑Ä‡∂±‡∑ì‡∂∫ ‡∑É‡∑ä‡∑Ä‡∑è‡∂∏‡∑í‡∂±‡∑ä ‡∑Ä‡∑Ñ‡∂±‡∑ä‡∑É, '${title}' ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä‡∂∫‡∑í: \n\n`);
        window.location.href = `mailto:info@dharmanethra.lk?subject=${subject}&body=${body}`;
    }

    function showPage(id) {
        const p = ['page-home', 'page-detail', 'page-merit', 'page-donate', 'page-about', 'page-contact'];
        p.forEach(x => document.getElementById(x).classList.add('hidden'));
        if(id === 'page-fav') {
            document.getElementById('page-home').classList.remove('hidden');
            draw(articles.filter(x => favs.includes(x.id)));
        } else {
            document.getElementById(id).classList.remove('hidden');
            if(id === 'page-home') draw(articles);
            if(id === 'page-merit') drawMerits();
        }
        window.scrollTo(0,0);
    }

    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    function changeFontSize(v) { fSize += v; document.getElementById('view-content').style.fontSize = fSize + 'px'; }
    function readArt() { window.speechSynthesis.cancel(); let u = new SpeechSynthesisUtterance(document.getElementById('view-content').innerText); u.lang='si-LK'; window.speechSynthesis.speak(u); }
    function toggleFav(id) {
        favs = favs.includes(id) ? favs.filter(x => x !== id) : [...favs, id];
        localStorage.setItem('f', JSON.stringify(favs));
        draw(articles);
    }
    function navArt(v) { let n = curIdx + v; if(n >= 0 && n < articles.length) openArt(n); }

    function addMerit() {
        const d = document.getElementById('merit-date').value;
        const t = document.getElementById('merit-text').value;
        if(d && t) {
            merits.unshift({ d, t, id: Date.now() });
            localStorage.setItem('m', JSON.stringify(merits));
            drawMerits();
            document.getElementById('merit-text').value = "";
        }
    }
    function drawMerits() {
        document.getElementById('merit-list').innerHTML = merits.map(m => `
            <div class="merit-item">
                <small>${m.d}</small><br>${m.t}
                <span style="position:absolute; right:15px; top:15px;" onclick="delMerit(${m.id})">üóëÔ∏è</span>
            </div>
        `).join('');
    }
    function delMerit(id) { merits = merits.filter(x => x.id !== id); localStorage.setItem('m', JSON.stringify(merits)); drawMerits(); }

    let t_int;
    function startTimer() {
        let s = 600; clearInterval(t_int);
        t_int = setInterval(() => {
            s--;
            let m=Math.floor(s/60), sec=s%60;
            document.getElementById('timer-display').innerText = `${m}:${sec < 10 ? '0'+sec : sec}`;
            if(s <= 0) { clearInterval(t_int); document.getElementById('bell').play(); alert("‡∂∑‡∑è‡∑Ä‡∂±‡∑è ‡∂ö‡∑è‡∂Ω‡∂∫ ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä!"); }
        }, 1000);
    }
    function resetTimer() { clearInterval(t_int); document.getElementById('timer-display').innerText = "10:00"; }

    window.onload = () => { tick(); getArts(); document.getElementById('merit-date').valueAsDate = new Date(); };
</script>
</body>
</html>