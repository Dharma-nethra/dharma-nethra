<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dharma Nethra - Admin</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #fffbf2; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #d35400; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .list-item { background: #f9f9f9; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid #eee; }
        .list-item-title { font-weight: bold; margin-bottom: 8px; }
        .list-item-buttons { display: flex; gap: 5px; }
        .list-item-buttons button { width: auto; padding: 8px 15px; font-size: 14px; }
        .btn-edit { background: #3498db; }
        .btn-delete { background: #e74c3c; }
        .btn-cancel { background: #95a5a6; }
        #editMode { display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #ffc107; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color:#d35400; text-align:center;">‡∑É‡∂Ø‡∑Ñ‡∂∏‡∑ä ‡∂Ω‡∑í‡∂¥‡∑í ‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∂´‡∂∫</h2>
    
    <!-- ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´ ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫ ‡∂Ø‡∂ª‡∑ä‡∑Å‡∂ö‡∂∫ -->
    <div id="editMode">
        <strong>üîÑ ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´ ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫:</strong> <span id="editTitle"></span>
        <button onclick="cancelEdit()" class="btn-cancel" style="margin-top: 10px;">‚ùå ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´‡∂∫ ‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
    </div>

    <input type="text" id="t" placeholder="‡∂∏‡∑è‡∂≠‡∑ò‡∂ö‡∑è‡∑Ä...">
    <textarea id="c" rows="8" placeholder="‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂∏‡∑ô‡∂≠‡∑ê‡∂±‡∂ß ‡∂¥‡∑ö‡∑É‡∑ä‡∂ß‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±..."></textarea>
    <button id="saveBtn" onclick="save()">‡∂á‡∂¥‡∑ä ‡∂ë‡∂ö‡∂ß ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (Upload)</button>
    <p id="msg" style="text-align:center; font-weight:bold;"></p>

    <hr>
    <h3>üìö ‡∂Ø‡∑ê‡∂±‡∂ß ‡∂á‡∂≠‡∑í ‡∂Ω‡∑í‡∂¥‡∑í ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä</h3>
    <div id="article-list">‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...</div>
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDEiwhtAIdoqdMIV5n_bdDoKuIrCkjqr3M",
        authDomain: "dharma-nethra.firebaseapp.com",
        databaseURL: "https://dharma-nethra-default-rtdb.firebaseio.com",
        projectId: "dharma-nethra",
        storageBucket: "dharma-nethra.firebasestorage.app",
        messagingSenderId: "365410669829",
        appId: "1:365410669829:web:d9a9465ed1f1f2b792936c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Ä‡∂± global variable
    let editingArticleId = null;

    // ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∑É‡∑î‡∂ª‡∑ê‡∂ö‡∑ì‡∂∏ ‡∑Ñ‡∑ù ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∑ì‡∂∏
    function save() {
        const title = document.getElementById('t').value;
        const content = document.getElementById('c').value;
        const msg = document.getElementById('msg');

        if(title && content) {
            if(editingArticleId) {
                // ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∑ì‡∂∏ (Update)
                db.ref('articles/' + editingArticleId).update({
                    title: title,
                    content: content,
                    time: Date.now()
                }).then(() => {
                    msg.style.color = "green";
                    msg.innerText = "‚úÖ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∑Ö‡∑è!";
                    clearForm();
                }).catch(err => {
                    msg.style.color = "red";
                    msg.innerText = "‚ùå ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä: " + err.message;
                });
            } else {
                // ‡∂±‡∑Ä ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫‡∂ö‡∑ä ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∑ì‡∂∏ (Add New)
                db.ref('articles').push({
                    title: title,
                    content: content,
                    time: Date.now()
                }).then(() => {
                    msg.style.color = "green";
                    msg.innerText = "‚úÖ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö‡∑è!";
                    clearForm();
                }).catch(err => {
                    msg.style.color = "red";
                    msg.innerText = "‚ùå ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä: " + err.message;
                });
            }
        } else { 
            alert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∑É‡∑í‡∂∫‡∂Ω‡∑ä‡∂Ω ‡∂¥‡∑î‡∂ª‡∑Ä‡∂±‡∑ä‡∂±."); 
        }
    }

    // ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    function editArticle(id, title, content) {
        editingArticleId = id;
        document.getElementById('t').value = title;
        document.getElementById('c').value = content;
        document.getElementById('editMode').style.display = 'block';
        document.getElementById('editTitle').innerText = title;
        document.getElementById('saveBtn').innerText = '‚úèÔ∏è ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (Update)';
        document.getElementById('saveBtn').style.background = '#27ae60';
        
        // ‡∂â‡∑Ñ‡∑Ö‡∂ß scroll ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´‡∂∫ ‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    function cancelEdit() {
        clearForm();
        document.getElementById('msg').innerText = '';
    }

    // ‡∑Ü‡∑ù‡∂ª‡∂∏‡∑ä ‡∂ë‡∂ö clear ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    function clearForm() {
        editingArticleId = null;
        document.getElementById('t').value = "";
        document.getElementById('c').value = "";
        document.getElementById('editMode').style.display = 'none';
        document.getElementById('saveBtn').innerText = '‡∂á‡∂¥‡∑ä ‡∂ë‡∂ö‡∂ß ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (Upload)';
        document.getElementById('saveBtn').style.background = '#d35400';
    }

    // ‡∂Ω‡∑í‡∂¥‡∑í ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏
    db.ref('articles').on('value', (snap) => {
        const list = document.getElementById('article-list');
        list.innerHTML = '';
        if(snap.exists()) {
            snap.forEach(child => {
                const a = child.val();
                const titleEscaped = a.title.replace(/'/g, "\\'");
                const contentEscaped = a.content.replace(/'/g, "\\'").replace(/\n/g, '\\n');
                
                list.innerHTML += `
                    <div class="list-item">
                        <div class="list-item-title">${a.title}</div>
                        <div class="list-item-buttons">
                            <button onclick="editArticle('${child.key}', '${titleEscaped}', '${contentEscaped}')" class="btn-edit">‚úèÔ∏è ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´‡∂∫</button>
                            <button onclick="del('${child.key}')" class="btn-delete">üóëÔ∏è ‡∂∏‡∂ö‡∂±‡∑ä‡∂±</button>
                        </div>
                    </div>
                `;
            });
        } else { 
            list.innerHTML = "‡∂≠‡∑Ä‡∂∏‡∂≠‡∑ä ‡∂Ω‡∑í‡∂¥‡∑í ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∂ö‡∑ä ‡∂±‡∑ê‡∂≠."; 
        }
    }, err => {
        document.getElementById('article-list').innerText = "‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä: " + err.message;
    });

    // ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑ì‡∂∏
    function del(id) {
        if(confirm("‡∂∏‡∑ô‡∂∏ ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?")) {
            db.ref('articles/' + id).remove();
        }
    }
</script>

</body>
</html>
